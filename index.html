<html lang="en">
  <head>
    <script src="https://integrations.missiveapp.com/missive.js"></script>
    <link
      href="https://integrations.missiveapp.com/missive.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <h1>Missive Context Data</h1>
    <div id="context" class="context-data">
      <p>Loading context data...</p>
    </div>

    <script type="text/javascript">
      function displayContextData(context) {
        const contextDiv = document.getElementById("context");
        if (!context || !context.conversation) {
          contextDiv.innerHTML = "<p>Error: No context received.</p>";
          return;
        }

        contextDiv.innerHTML = `
      <h2>Conversation ID: ${context.conversation.id}</h2>
      <p><strong>Subject:</strong> ${context.conversation.subject}</p>
      <p><strong>Participants:</strong> ${context.conversation.participants
        .map((p) => p.name)
        .join(", ")}</p>
      <p><strong>Last Message:</strong> ${
        context.conversation.last_message?.snippet || "No messages yet"
      }</p>
    `;
      }

      Missive.on("context", function (context) {
        displayContextData(context);
      });

      Missive.ready();
    </script>
  </body>
</html>
